---
title: "LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã§TeXã‚’æ‰±ã„ãŸã‹ã£ãŸè©±"
emoji: "ğŸ™†"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["LINE", "LIFF", "Nextjs", "TeX"]
published: true
---
# å‹•æ©Ÿ
æ•°å­¦ç³»ã®ã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã«ã„ã‚‹ã¨ã€ã¡ã‚‡ã£ã¨è¤‡é›‘ãªæ•°å¼ã‚’é€ã‚ŠãŸã„ã¨ããŒã©ã†ã—ã¦ã‚‚ã‚ã‚Šã¾ã™ã€‚
```
x = {-b+-âˆš(b^2 -4ac)}ã€€/ã€€2a
```
ã¨ã‹
```
âˆ‘[n=1~âˆ]1/n^2 = Ï€^2/6
```
ã¨ã‹...
ã‚ã¾ã‚Šã«è¤‡é›‘é•·å¤§ãªã‚‚ã®ã¯ç´™ã«æ›¸ã„ãŸã‚ŠTeXãªã©ã®çµ„ç‰ˆå‡¦ç†ã‚½ãƒ•ãƒˆã‚’ä½¿ã£ãŸã‚Šã—ã¦ç”»åƒã«ã—ã¦é€ã‚‹ã‚ã‘ã§ã™ãŒã€ä¸Šã«æŒ™ã’ãŸç¨‹åº¦ã® (ï¼‘è¡Œã€œæ•°è¡Œã§æ›¸ã‘ã‚‹) å¼ã§ã„ã¡ã„ã¡ãã‚“ãªã“ã¨ã‚’ã™ã‚‹ã®ã¯é¢å€’ãªã®ã§ (ç”Ÿã®TeXã‚’é€ã‚‹äººã‚‚ã„ã¾ã™ãŒã€èª­ã‚ãªã„äººã‚‚ã„ã‚‹ã®ã§å¾®å¦™ã§ã™) ã“ã‚“ãªæ„Ÿã˜ã§ãªã‚“ã¨ã‹ä¼ã‚ã‚‹ã‚ˆã†ã«æ›¸ã„ã¦é€ã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚

ã“ã‚Œã¯PCãªã‚‰LINEã¨ã‚½ãƒ•ãƒˆã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’æ¨ªã«ä¸¦ã¹ã‚Œã°ã„ã„è©±ãªã®ã§å•é¡Œã«ãªã‚Šã«ãã„ã§ã—ã‚‡ã†ã‹ã‚‰ã€ä»¥ä¸‹ã§ã¯ä¸»ã«**ã‚¹ãƒãƒ›ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å¯¾è±¡**ã¨ã—ã¦è©±ã‚’é€²ã‚ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

# æ§‹æƒ³
LINEã§TeXã¨ã‹ä½¿ãˆãŸã‚‰ä¾¿åˆ©ã ã‚ˆã­ã€œã¨ã„ã†è©±ã¯ä»¥å‰ã‹ã‚‰ãŸã¾ã«å‡ºã¦ã„ã¦ã€å®Ÿéš›ã€ã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆ**ä»¥å¤–**ã§ãªã‚‰
https://qiita.com/plageoj/items/3df087999d550338e2b8
https://qiita.com/yudukikun5120/items/ec2fc172d180c099f24d
ã¨ã„ã£ãŸMessaging APIã‚’ç”¨ã„ã‚‹å‰ä¾‹ãŒå­˜åœ¨ã—ã¾ã™ã€‚
ãªãœã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã§ã¯ä¾‹ãŒãªã„ã‹ã¨ã„ã†ã¨ã€ã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã§ã¯Messaging APIãŒä½¿ãˆãªã„ãŸã‚
```
TeXã‚’é€ã‚‹ã€€-> botãŒå‡¦ç†ã—ã¦è‡ªå‹•ã§ç”»åƒã‚’é€ã‚‹
```
ã¨ã„ã†æµã‚Œã‚’å®Ÿç¾ã§ããªã„ã‹ã‚‰ã§ã™ã€‚

ã“ã‚Œã¯LINEã®å¤–ã®æˆ‘ã€…ãŒã©ã†ã«ã‹ã§ãã‚‹ã‚‚ã®ã§ã¯ãªã„ã®ã§ã€ä»£æ›¿æ‰‹æ®µã¨ã—ã¦
```
LINEä¸Šã§TeXã‚’æ›¸ã„ã¦ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ -> æ‰‹å‹•ã§ç”»åƒã‚’é€ã‚‹
```
ã¨ã„ã†æµã‚ŒãŒã¾ãšæµ®ã‹ã³ã¾ã™ã€‚ã“ã‚Œã¯[LIFF](https://developers.line.biz/ja/docs/liff/overview/)ã‚’ä½¿ãˆã°å®Ÿç¾ã§ããã†ã«è¦‹ãˆã¾ã™ã€‚æ­£å¼å¯¾å¿œã—ã¦ã„ãªã„ã¨æ›¸ã‹ã‚Œã¦ã¯ã„ã¾ã™ãŒã€ä»Šå›ã¯ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã‚„å‹é”æƒ…å ±ãªã©ã¯ä¸€åˆ‡å¿…è¦ã¨ã—ã¦ã„ãªã„ã®ã§å•é¡Œãªã•ãã†ã§ã™ã€‚å®Ÿéš›ã«æ›¸ã„ã¦ã¿ãŸã‚³ãƒ¼ãƒ‰ãŒä»¥ä¸‹ã«ãªã‚Šã¾ã™ (Next.js) ã€‚

```ts:index.ts
import { ChangeEvent, useEffect, useState } from 'react'
import Head from 'next/head'
import styles from '../styles/main.modules.css'
import katex from 'katex'
import html2canvas from 'html2canvas'


const downloadKatexImage = (katexArea: HTMLElement) => {
    html2canvas(katexArea)
        .then(canvas => {
            const downloadLink.href = document.getElementByTagName("a")[0]
            downloadLink.href = canvas.toDataURL()
            downloadLink.click()
        })
}
const renderKatex = (
    katexArea: HTMLElement,
    inputText: string
  ) => {
    katex.render(String.raw`${inputText}`, katexArea, {
        throwOnError: false,
        displayMode: true
    })
}
const getProperKatexFontSize = (
    katexArea: HTMLElement,
    currentFontSize: number
  ): number => {
    const katexBox = document.getElementsByClassName('katex')[0]
    // katexã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œã‚‹ã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹KaTeXã‚’ã™ã£ã½ã‚Šå›²ã†spanè¦ç´ 

    const wRate = katexArea.clientWidth / katexBox.clientWidth
    const hRate = katexArea.clientHeight / katexBox.clientWidth

    return Min(
        Min(
            currentFontSize * wRate,
            defaultKatexFontSize
        ),
        Min(
            currentFontSize * hRate,
            defaultKatexFontSize
        )
    )
}

const deaultKatexFontSize = 3
const Min = (x:number, y:number) => {
    if (x <= y) return x
    return y
}


const Home = () => {
    const LiffID = process.env.LIFF_ID || ''
    useEffect(() => {
        import('@line/liff').then(liffFile => {
            const liff = liffFile.default
            liff.init({
                liffId: LiffID,
                withLoginOnEnternalBrowser: true
            })
        })
    }, [])

    const [katexFontsize, setKatexFontSize] = useState(defaultKatexFontSize)
    const [katexArea, setKatexArea] = useState<HTMLElement>()
    useEffect(() => {
        setKatexarea(
            document.getById('katex-area')!
        )
    }, [])

    const handleChange = (e: ChangeEvent<HTMLTextAreaElement>) => {
        renderKatex(katexArea!, e.target.value)
        const newKatexFontSize = getProperKatexFontSize(katexArea!, katexFontSize)
        setKatexFontsize(newKatexFontSize)
        document.documentElement.style.setProperty(
            '--katex-font-size', `${newKatexFontSize}em`
        )
    }
    const handleClick = () => {
        downloadKatexImage(katexArea!)
    }

    return (
        <Head>
          <title>LIFF-TEX</title>
          <link rel='icon' href='/favicon.ico'/>
        </Head>
        <main className={styles.mainStyle}>
          <div 
            className={styles.katexAreaStyle}
            id='katex-area'
          />
          <textarea
            className={styles.inputStyle}
            onChange={(e) => handleChange(e)}
          />
          <button className={styles.buttonStyle} onClick={handleClick}>
            download
          </button>
          <a download='KaTeX.png'></a>
        </main>
    )
}

export default Home
```

```ts:_document.ts
import { Html, Head, Main, NextScript } from "next/document";

const Document = () => {
  return (
    <Html>
      <Head>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css" integrity="sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB" crossOrigin="anonymous"/>
      </Head>
      <body>
        <Main />
        <NextScript />
      </body>
    </Html>
  )
}

export default Document
```
CSSãªã©ã¯çœç•¥ã—ã¾ã™ãŒã€ã“ã“ã«å®Ÿéš›ã«å‹•ãã‚‚ã®ã‚’ç½®ã„ã¦ãŠãã®ã§ã€ã‚ˆã‘ã‚Œã°éŠã‚“ã§ã‚ã’ã¦ãã ã•ã„ã€‚
https://liff-tex-kana-rus.vercel.app

ã•ã¦ã€çµè«–ã‹ã‚‰è¨€ã†ã¨ã€ã“ã‚Œã§ã¯ç›®çš„ã‚’æœãŸã™ã“ã¨ã¯**ã§ãã¾ã›ã‚“**ã€‚TeXã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã¨ã“ã‚ã¾ã§ã¯å•é¡Œãªã„ã®ã§ã™ãŒã€ç”»åƒã‚’**ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ãŒã§ããªã„**ã®ã§ã™ã€‚èª¿ã¹ã¦ã¿ãŸã¨ã“ã‚ã€ã“ã‚Œã¯LINEãƒ–ãƒ©ã‚¦ã‚¶ / LIFFãƒ–ãƒ©ã‚¦ã‚¶ã®ä»•æ§˜ã«èµ·å› ã™ã‚‹ã‚‚ã®ã§ã‚ã‚Šã€ç”»åƒã ã‘ã§ãªãã€ä¸€èˆ¬ã«ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰è‡ªä½“ã§ããªã„ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

> LIFFãƒ–ãƒ©ã‚¦ã‚¶ã¯ã€iOSã§ã¯WKWebView (opens new window)ã€Androidã§ã¯Android WebView (opens new window)ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã€LIFFãƒ–ãƒ©ã‚¦ã‚¶ã®ä»•æ§˜ãŠã‚ˆã³å‹•ä½œã«ã¤ã„ã¦ã‚‚ã“ã‚Œã‚‰ã®ä»•çµ„ã¿ã«æº–æ‹ ã™ã‚‹ã‚‚ã®ã¨ãªã‚Šã¾ã™ã€‚
https://developers.line.biz/ja/docs/liff/overview/#liff-browser

https://pisuke-code.com/android-webview-download-file/
https://zenn.dev/bricklife/articles/how-to-download-blob-on-wkwebview

ã¤ã¾ã‚Šã€LINEå´ã§å¯¾å¿œã™ã‚‹å®Ÿè£…ã‚’æ–½ã—ã¦ãã‚Œãªã„é™ã‚Šãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¯å®Ÿç¾ã—ãªã„ã®ã§ã‚ã‚Šã€ã“ã‚Œã‚‚Webã‚¢ãƒ—ãƒªå´ã§ã¯ã©ã†ã—ã‚ˆã†ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚

# å†æ§‹æƒ³
ã§ã¯ã©ã†ã™ã‚‹ã‹ã§ã™ãŒã€å¤§ããåˆ†ã‘ã¦ä»¥ä¸‹ã®ï¼’ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ–¹é‡ã‚’è€ƒãˆã¾ã—ãŸã€‚

1. å¤–éƒ¨ã«åˆ¥ã®APIã‚’ç”¨æ„ã—ã¦ç„¡ç†çŸ¢ç†è¿‚å›ã™ã‚‹
```
ä¾‹: ç”»åƒã®DataURLã‚’å–å¾—
 -> å¤–éƒ¨APIã«POST, å¤–éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã‹ã›ã‚‹
 -> APIã¯ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚ŒãŸç¬é–“POSTã•ã‚ŒãŸç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã›ã‚‹
 -> æ‰‹å‹•ã§ï¼‘ç”»é¢æˆ»ã£ã¦ã‚‚ã‚‰ã† (ã¨è‡ªå‹•ã§å…ƒã®ã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã«é·ç§»)
```
2. æœ€åˆã‹ã‚‰å¤–éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã‹ã›ã‚‹
```
ä¾‹: ãã‚‚ãã‚‚Webã‚¢ãƒ—ãƒªã‚’å¤–éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã‹ã›ã‚‹
 -> ç”»åƒã®DataURLå–å¾— & ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã›ã‚‹
 -> æ‰‹å‹•ã§ï¼‘ç”»é¢æˆ»ã£ã¦ã‚‚ã‚‰ã† (ã¨è‡ªå‹•ã§å…ƒã®ã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã«é·ç§»)
```
å•é¡Œã¯**å¤–éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã‹ã›ã‚‹**ã¨è¨€ã†éƒ¨åˆ†ã§ã€æ™®é€šã«LINEä¸Šã§URLã‚’é–‹ã„ã¦ã‚‚å¿…ãš**LINEãƒ–ãƒ©ã‚¦ã‚¶**ã§é–‹ã‹ã‚Œã¦ã—ã¾ã„ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒã§ãã¾ã›ã‚“ã€‚

ã“ã‚“ãªã‚‚ã®ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚
> LINEã‚¢ãƒ—ãƒªã‹ã‚‰ä»¥ä¸‹ã®ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä»˜ä¸ã—ãŸä»»æ„ã®URLã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€LINEå†…ãƒ–ãƒ©ã‚¦ã‚¶ã®ä»£ã‚ã‚Šã«å¤–éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶ã§URLã‚’é–‹ãã¾ã™ã€‚...
https://developers.line.biz/ja/docs/messaging-api/using-line-url-scheme/

ã“ã‚Œã‚’ä½¿ãˆã°å¼·åˆ¶çš„ã«å¤–éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã‹ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€
> ã“ã®LINE URLã‚¹ã‚­ãƒ¼ãƒ ã¯ã€LINEã‚¢ãƒ—ãƒªã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã™ã¹ã¦ã®URLã§æ©Ÿèƒ½ã—ã¾ã™ã€‚ãŸã ã—ã€LIFFã‚¢ãƒ—ãƒªã®ã¿ä¾‹å¤–çš„ã«ã‚µãƒãƒ¼ãƒˆã•ã‚Œãªã„ãŸã‚ã€ãŸã¨ãˆã°LIFF URLã«ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä»˜ä¸ã—ã¦ã‚‚æ©Ÿèƒ½ã—ã¾ã›ã‚“ã€‚

ã¨ã®ã“ã¨ãªã®ã§ã€1.ã®æ¡ˆã¯ä¸å¯èƒ½ã§ã™ã€‚ã¤ã¾ã‚Šã€ã‚¢ãƒ—ãƒªã®URL https://liff-tex-kana-rus.vercel.appã€€ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ openExternalBrowser=1 ã‚’ã¤ã‘ãŸ
**https://liff-tex-kana-rus.vercel.app?openExternalBrowser=1**
ã‚’ã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã®ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã«ã§ã‚‚ç½®ã„ã¦ãŠã„ã¦ã€å¿…è¦ãªæ™‚ã«ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚¢ãƒ—ãƒªã«é£›ã¹ã°ã„ã„è¨³ã§ã™ã€‚

æ­£ç›´ã€æœ€åˆã«æƒ³å®šã—ã¦ã„ãŸã®ã¨ã¯ã‹ãªã‚Šé•ã£ãŸå½¢ã«ãªã‚Šã€äº‹å‰èª¿æŸ»ã®ä¸è¶³ã‚’ç—›æ„Ÿã—ã¦ã„ã¾ã™ã€‚ã“ã†ãªã‚‹ã¨æ™®é€šã«ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒªã‚’ä½¿ã†ã®ã¨å¤§å·®ãªããªã£ã¦ã„ã‚‹æ°—ã‚‚ã—ã¾ã™ãŒã€
```
ãƒã‚¤ãƒ†ã‚£ãƒ–ï¼š
   æ‰‹å‹•ã§LINEã‚’æŠœã‘ã¦ã‚¢ãƒ—ãƒªã‚’é–‹ã
-> æ›¸ã„ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
-> æ‰‹å‹•ã§ã‚¢ãƒ—ãƒªã‚’æŠœã‘ã¦LINEã«ç§»å‹•ã™ã‚‹
```
```
Web:
   (ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã—ã¦ãŠã‘ã°)ã€€LINEä¸Šã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹URLã§ã‚¢ãƒ—ãƒªã«é£›ã¶
-> æ›¸ã„ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
-> ï¼‘ç”»é¢æˆ»ã‚‹ã€€(ã¨è‡ªå‹•ã§å…ƒã®ã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã«é·ç§»)
```
ã¨ã„ã†æ‰‹é–“ã®å·®ãŒç”Ÿã˜ã‚‹ã®ã§ã€Webã‚¢ãƒ—ãƒªã‚’ä½œã£ãŸæ„å‘³ã¯ã‚ã£ãŸã¨æ€ã„ãŸã„ã§ã™ã€‚

æœ€å¾Œã¾ã§èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚