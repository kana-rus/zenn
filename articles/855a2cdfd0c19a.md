---
title: "åˆæ ¼ç™ºè¡¨ã®ç¬é–“ã«å†…å®¹ã‚’LINEã¸é€ã‚ŠãŸã‹ã£ãŸè©±"
emoji: "ğŸŒŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Go", "Heroku", "GAS", "LINE"]
published: false
---
åˆè¨˜äº‹ã§ã™ã€‚ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚
# Introduction
å¤§å­¦å…¥è©¦ãŒçµ‚ã‚ã£ã¦åˆæ ¼ç™ºè¡¨ã‚’å¾…ã£ã¦ã‚‹æœŸé–“ã£ã¦æš‡ã§ã™ã‚ˆã­ (åƒ•ã¯æš‡ã§ã—ãŸ) ã€‚ãã‚Œã§ã€ã›ã£ã‹ããªã®ã§é«˜æ ¡ç”Ÿæœ€å¾Œã®æ€ã„å‡ºã«ãªã‚‹ã‚‚ã®ã‚’ä½œã‚ŠãŸã„ã¨æ€ã£ã¦ã€ã“ã‚“ãªã“ã¨ã‚’è€ƒãˆã¾ã—ãŸã€‚
### Planï¼š
1. åˆæ ¼ç™ºè¡¨ãƒšãƒ¼ã‚¸ã‚’ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã—ã¦åˆæ ¼ã—ãŸç•ªå·ã®ä¸€è¦§ã¨è‡ªåˆ†ã®åˆå¦ã‚’èª¿ã¹ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
2. ï¼‘ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™APIã‚’ä½œã‚‹
3. ï¼’ã®APIã‚’å©ã„ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã—ã¦LINEã«é€ã‚‹ä»•çµ„ã¿ã‚’ä½œã‚‹

ã§ã€ç™ºè¡¨æ™‚åˆ»ã¡ã‚‡ã†ã©ã«è‡ªå‹•ã§ï¼‘ï¼Œï¼’ï¼Œï¼“ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ãŠã‘ã°ã€ä»–ã®äººé–“ãŸã¡ãŒã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãƒšãƒ¼ã‚¸ãŒé‡ããªã‚‹å‰ã«åˆæ ¼ç™ºè¡¨ã«é–¢ã™ã‚‹æƒ…å ±ã‚’å–å¾—ã—ã¦ã€ã‚†ã£ãã‚ŠLINEã§çœºã‚ã‚‹ã“ã¨ãŒã§ãã‚‹ã¨ã„ã†ã‚ã‘ã§ã™ã€‚ã¡ãªã¿ã«ã€ï¼‘ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ãŸãªã‚‰ãã®ã¾ã¾ç›´æ¥ LINE MessagingAPI ã‚’å©ã‘ã°ã„ã„ã¨ã“ã‚ã§ã™ãŒã€ã€Œ1ï¼š**Go**å…¥é–€ã¨ã—ã¦Goã§ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã—ã¦ã¿ãŸã„ã€ã€Œ2ï¼šAPIä½œã£ã¦ã¿ãŸã„ã€ã€Œ3ï¼š**MessagingAPI**ä½¿ã£ã¦ã¿ãŸã„ã€ã¨ã„ã†å‹•æ©ŸãŒã‚ã‚Šã€API (ã”ãç°¡å˜ãªã‚‚ã®ã§ã™ãŒ) ã‚’ä½œã‚‹çµŒé¨“ã‚’ã™ã‚‹ãŸã‚ã«ã“ã®æ§‹æˆã«ã—ã¾ã—ãŸã€‚
å¯¾è±¡ãƒšãƒ¼ã‚¸ã¯[äº¬å¤§å·¥å­¦éƒ¨ã®åˆæ ¼ç™ºè¡¨ãƒšãƒ¼ã‚¸](https://daigakujc.jp/pa.php?u=31&h=24&f=19)ã§ã™(3/17 17:00ã¾ã§æ²è¼‰)ã€‚ã¾ãŸã€ï¼’ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã«ã¯**Heroku**ã€ï¼“ã«ã¯**GAS**ã‚’æ¡ç”¨ã—ã¾ã—ãŸã€‚
```mermaid
sequenceDiagram
    participant å¯¾è±¡ãƒšãƒ¼ã‚¸
    participant Go on Heroku
    Go on Heroku->>å¯¾è±¡ãƒšãƒ¼ã‚¸: Scrape
    å¯¾è±¡ãƒšãƒ¼ã‚¸->>Go on Heroku: Data
    GAS->>Go on Heroku: GET
    Go on Heroku->>GAS: Data
    GAS->>LINEã‚¢ãƒ—ãƒª: Message
    Note over GAS,LINEã‚¢ãƒ—ãƒª: by Messaging API
```
GASã‚‚åˆã‚ã¦è§¦ã‚Šã¾ã—ãŸãŒã€ã“ã‚Œã¯ã»ã¼JSã§ãã“ã¾ã§å›°ã‚‹ã“ã¨ãªãæ›¸ã‘ãŸã®ã§ã€å®Œæˆã—ãŸã‚³ãƒ¼ãƒ‰ã‚’ç¤ºã™ã«ç•™ã‚ã€ã“ã®è¨˜äº‹ã§ã¯ï¼‘ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã«ç„¦ç‚¹ã‚’å½“ã¦ãŸã„ã¨æ€ã„ã¾ã™ã€‚

```gs:main.gs
let apiURL = PropertiesService.getScriptProperties().getProperty('API_URL')
let userID = PropertiesService.getScriptProperties().getProperty('USER_ID')
let accessToken = PropertiesService.getScriptProperties().getProperty('CHANNEL_ACCESS_TOKEN')

function main() { // 3/10 12:00 å®Ÿè¡Œ
  Utilities.sleep(3 * 1000) // ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å®Œäº†ã‚’å¾…ã¤ (ï¼“ç§’ã¯ã¡ã‚‡ã£ã¨é•·ã‚)
  let jsonData = GetJSONdata(apiURL)

  let idList = jsonData["id_list"]
   // MessagingAPI ã®æ–‡å­—æ•°åˆ¶é™ (ï¼•ï¼ï¼ï¼æ–‡å­—) ã®ãŸã‚ï¼’å›ã«ã‚ã‘ã¦é€ã‚‹
  let message1 = idList.slice(0,501).join("\n")
  PushMessage(message1)
  let message2 = idList.slice(501).join("\n")
  PushMessage(message2)

   // åˆæ ¼orä¸åˆæ ¼
  let passed = jsonData["passed"]
  let result = ""
  if (passed) {
    result = "åˆæ ¼"
  } else {
    result = "ä¸åˆæ ¼"
  }
  PushMessage(result)
}

function AwakeHeroku(){ // 3/10 11:45 å®Ÿè¡Œ
  UrlFetchApp.fetch(apiURL)
}


function GetJSONdata(url){
  let res = UrlFetchApp.fetch(url).getContentText()
  return JSON.parse(res)
}

function PushMessage(messageText){
  let url = 'https://api.line.me/v2/bot/message/push'
  let headers = {
    'Content-Type': 'application/json; charset=UTF-8',
    'Authorization': 'Bearer ' + accessToken,
  }
  let postData = {
    'to': userID,
    'messages': [{
      'type': 'text',
      'text': messageText,
    }]
  }
  let options = {
    'method': 'post',
    'headers': headers,
    'payload': JSON.stringify(postData)
  }
  return UrlFetchApp.fetch(url, options)
}
```
:::message
- GAS ã¯ Zenn ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆæœªå¯¾å¿œ
- Property ã¨ Trigger (timeBased) ã¯åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã§è¨­å®šæ¸ˆ
:::

# Scraping
### æƒ…å ±åé›†
ã§ã¯æœ¬é¡Œã«å…¥ã‚Šã¾ã™ã€‚æ—©é€Ÿã§ã™ãŒã€é‡å¤§ãªå•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚å‹˜ã®ã„ã„æ–¹oräº¬å¤§ã®å…ˆè¼©æ–¹ã¯æ°—ã¥ã„ãŸã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€åˆæ ¼ç™ºè¡¨å‰ã¯ãã‚‚ãã‚‚å¯¾è±¡ãƒšãƒ¼ã‚¸ãŒWebä¸Šã«å­˜åœ¨ã—ãªã„ã®ã§ã™ã€‚ãƒšãƒ¼ã‚¸è‡ªä½“ãŒåˆæ ¼ç™ºè¡¨ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å…¬é–‹ã•ã‚Œã‚‹ã®ã§ã€äº‹å‰ã«URLã‚‚åˆ†ã‹ã‚Šã¾ã›ã‚“ã—ã€HTMLã®æ§‹é€ ã‚‚å½“ç„¶åˆ†ã‹ã‚Šã¾ã›ã‚“ã€‚ã“ã‚Œã§ã¯è©±ãŒé€²ã¾ãªã„ã®ã§ã€YouTubeã§äº¬å¤§ã®åˆæ ¼ç™ºè¡¨ãƒšãƒ¼ã‚¸ãŒå†™ã‚Šè¾¼ã‚“ã§ã„ã‚‹å‹•ç”»ã‚’æ¢ã—ã¾ãã£ã¦æƒ…å ±åé›†ã—ã¾ã—ãŸã€‚ãã®çµæœåˆ†ã‹ã£ãŸã“ã¨ã¯ã€
- ç™ºè¡¨æ™‚åˆ»ã«ã€[ã“ã®ãƒšãƒ¼ã‚¸](https://daigakujc.jp/pal.php?u=31&h=24)ã«å„å­¦ç§‘åã®ãƒªãƒ³ã‚¯ãŒä¸¦ã¶ (ï¼š**Aãƒšãƒ¼ã‚¸**ã¨ã™ã‚‹)
![](https://storage.googleapis.com/zenn-user-upload/c3b857af90a7-20220311.png =450x)
*ç™ºè¡¨å‰*
- "å·¥å­¦éƒ¨"ã®ãƒªãƒ³ã‚¯ã§é£›ã‚“ã å…ˆãŒå·¥å­¦éƒ¨ã®ç™ºè¡¨ãƒšãƒ¼ã‚¸ã€‚ãã®URLã¯ä¸Šè¨˜ãƒšãƒ¼ã‚¸ã®URLã«ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿"f=æ•´æ•°"ãŒãã£ã¤ã„ãŸå½¢ã‚’ã—ã¦ã„ã‚‹ãŒã€ã“ã‚Œã¯æ¯å¹´åŒã˜ã¨ã¯é™ã‚‰ãªã„ã‹ã‚‚ã—ã‚Œãªã„ã¨ãªã‚‹ã¨ã€äºˆæƒ³ãŒã¤ã‹ãªã„
- ç™ºè¡¨ãƒšãƒ¼ã‚¸è‡ªä½“ã¯ã€ç°¡å˜ãªèª¬æ˜ã¨ç¸¦ã«ä¸¦ã‚“ã ç•ªå·ãŒã‚ã‚‹ã ã‘ (ï¼š**Bãƒšãƒ¼ã‚¸**ã¨ã™ã‚‹)
![](https://storage.googleapis.com/zenn-user-upload/d9ac66054517-20220311.png =450x)
*ã“ã‚Œã¯ç™ºè¡¨å¾Œã«æ’®ã£ãŸå®Ÿéš›ã®å†™çœŸã ãŒã€* 
*ã“ã‚“ãªæ„Ÿã˜ã ã¨ã„ã†ã“ã¨ã¯å‹•ç”»ã§äº‹å‰ã«ç¢ºèªã§ããŸ*

ãã‚‰ã„ã§ã™ã€‚ã“ã®æ¡ä»¶ã§ã€ç™ºè¡¨ã®ç¬é–“ã«Bãƒšãƒ¼ã‚¸ã‹ã‚‰
- åˆæ ¼ã—ãŸã€Œç•ªå·+ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã€(ï¼š**ID** ã¨ã™ã‚‹) (Bãƒšãƒ¼ã‚¸ç”»åƒå‚ç…§) ã®ä¸€è¦§
- è‡ªåˆ†ã®åˆå¦

ã‚’å–å¾—ã™ã‚‹ã®ãŒç›®æ¨™ã§ã™ã€‚å‰è€…ãŒã§ãã‚Œã°å¾Œè€…ã¯å®¹æ˜“ãªã®ã§ã€å‰è€…ã‚’ãªã‚“ã¨ã‹ã™ã‚‹ã“ã¨ã‚’è€ƒãˆã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚Go ã®åŸºç¤æ–‡æ³•ã‚’ã–ã£ã¨å‹‰å¼·ã—ã¦ã‹ã‚‰ã€Go ã§ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã«ã¯ã©ã‚“ãª package ãŒä½¿ãˆã‚‹ã‹èª¿ã¹ã¦ã¿ãŸã¨ã“ã‚ã€**goquery** ã¨ã„ã† package ãŒã€Github ã®ã‚¹ã‚¿ãƒ¼æ•°ãŒååˆ†å¤šãã€æœ€çµ‚æ›´æ–°ãŒå»å¹´ã®10æœˆ (åŸ·ç­†æ™‚ç‚¹) ã§å®‰å®šã—ã¦ãã†ã€ã‹ã¤ãƒãƒƒãƒˆä¸Šã®æ—¥æœ¬èªè¨˜äº‹æ•°ã®ç‚¹ã§ã¯é ­ä¸€ã¤æŠœã‘ã¦ã„ã‚‹ã‚ˆã†ã«æ„Ÿã˜ãŸã®ã§ã€ä»Šå›ã¯ã“ã‚Œã‚’æ¡ç”¨ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

### æ§‹æƒ³
ã¨ã„ã†ã“ã¨ã§ã€goquery ã«æ…£ã‚Œã‚‹ã¹ãã„ã‚ã„ã‚æ›¸ã„ã¦ã¿ãªãŒã‚‰ã€ä»Šå›ã®ç›®æ¨™ã‚’é”æˆã™ã‚‹ãŸã‚ã«æ¬¡ã®ã‚ˆã†ãªæ–¹é‡ã‚’ç«‹ã¦ã¾ã—ãŸã€‚

1. Aãƒšãƒ¼ã‚¸ã‚’ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã—ã€ã€Œtext ãŒ"å·¥å­¦éƒ¨"ã¨ãªã£ã¦ã„ã‚‹ a ã‚¿ã‚°ã® hrefã€ã‚’å–å¾—ã™ã‚‹ã€‚
2. å¿…è¦ãªã‚‰ href ã‚’"https://..."ã®å½¢ã«åŠ å·¥ã™ã‚‹ã€‚ã“ã®URLã‚’ä½¿ã£ã¦Bãƒšãƒ¼ã‚¸ã‚’ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
3. Bãƒšãƒ¼ã‚¸ã‚’ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã—ã€åˆæ ¼ã—ãŸIDã®ãƒªã‚¹ãƒˆã‚’å–å¾—ã™ã‚‹ã€‚

ãŸã ã—ã€æœ€åˆã«æ›¸ã„ãŸã‚ˆã†ã«Bãƒšãƒ¼ã‚¸ã®HTMLã¯äº‹å‰ã«åˆ†ã‹ã‚‰ãªã„ãŸã‚ã€ã“ã“ã¯æƒ³åƒã«é ¼ã‚‹ã—ã‹ãªã„ã§ã™ã€‚å½“ç„¶ãƒ†ã‚¹ãƒˆã‚‚ä¸å¯èƒ½ã§ã™ã€‚åƒ•ã¯ã€å…ˆç¨‹ã®å†™çœŸã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã®HTMLã‚’æƒ³å®šã—ã¾ã—ãŸã€‚

```html:bpage.html
<!--ç•¥-->
<body>
    <hN class="school">å·¥å­¦éƒ¨</hN>
    <p>[åˆæ ¼è€…ç•ªå·ä¸€è¦§]</p>
    <p>å—é¨“ç•ªå·ã®å¾Œã®ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã¯ã€åˆæ ¼ã—ãŸå­¦ç§‘ã‚’è¡¨ã™ã€‚</p>
    <p>A åœ°çƒå·¥å­¦ç§‘</p>
    <p>B å»ºç¯‰å­¦ç§‘</p>
    <p>C ç‰©ç†å·¥å­¦ç§‘</p>
    <p>D é›»æ°—é›»å­å·¥å­¦ç§‘</p>
    <p>E æƒ…å ±å­¦ç§‘</p>
    <p>F å·¥æ¥­åŒ–å­¦ç§‘</p>
    <p>0007C</p>
    <p>0010E</p>
    <p>0013C</p>
    <p>0014B</p>
    <p>0016F</p>
    <p>0019B</p>
    <p>0020F</p>
    <p>0023C</p>
    <p>0025A</p>
    <!--ID ã¯é©å½“-->
    <!--ä»¥ä¸‹ç•¥-->
</body>
</html>
```
è‡ªåˆ†ãŒ React å¥½ããªã®ã‚‚ã‚ã‚Šã€ ID éƒ¨åˆ† (**930å€‹**ãã‚‰ã„) ã¯ã€ŒArray ã‚’ map ã§ãƒãƒ©ã—ã¦ä½œã£ãŸ JSXã€ã®ã‚ˆã†ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç„¡æ„è­˜ã«æŒã£ã¦ã„ã¾ã—ãŸã€‚ä»Šã«ã—ã¦æ€ãˆã°ã“ã®æ€ã„è¾¼ã¿ãŒãƒ€ãƒ¡ã§ã—ãŸã€‚

ãã‚Œã¯ã¨ã‚‚ã‹ãã€ã“ã®HTMLã‚’æƒ³å®šã—ã¦æ›¸ã„ãŸ Go ã®ã‚³ãƒ¼ãƒ‰ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚

```go:scrape.go
package main

import (
	"log"
	"regexp"
	"strings"

	"github.com/PuerkitoBio/goquery"
	"golang.org/x/text/encoding/japanese"
	"golang.org/x/text/transform"
)

type ScrapeInfo struct {
  baseURL       string
  preScrapePath string
  examCategory  string
  examNumber    string
}
func scrape(si ScrapeInfo) ([]string, bool) {
  var (
    baseURL        = si.baseURL
    preScrapePath  = si.preScrapePath
    myExamCategory = si.examCategory
    myExamNumber   = si.examNumber
  )
  var (
    preScrapeURL  = baseURL + preScrapePath
    myCategoryURL string
  )

  // 1.
  href := findHrefOf(myExamCategory, preScrapeURL)
  // 2.
  if href[0:5] == "https" {
    myCategoryURL = href
  } else {
    myCategoryURL = baseURL + href
  }
  // 3.
  passedIDs := findPassedIDsFrom(myCategoryURL)  
  iHasPassed := false
  for _, id := range passedIDs {
    if id[0:4] == myExamNumber {
      iHasPassed = true
      break
    }
  }  
  return passedIDs, iHasPassed
}

func findHrefOf(targetWord, targetURL string) string {
  // ãƒšãƒ¼ã‚¸å…¨ä½“ã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã—ã¦èª­ã¿è¾¼ã‚€
  doc, err := goquery.NewDocument(targetURL)
  if err != nil {
    log.Fatal(err)
  }

  var targetHref string
  // a ã‚¿ã‚°ã‚’èª¿ã¹ä¸Šã’ã‚‹
  doc.Find("a").EachWithBreak( func(i int, s *goquery.Selection) bool {
    href, exists := s.Attr("href")
    isTargetTag := (s.Text() == targetWord)  
    if exists && isTargetTag {
      targetHref = href
    }
    return !isTargetTag
    // EachWithBreak...Each(func) ã—ã¤ã¤ã€func ã®è¿”ã‚Šå€¤ãŒ false ã®ã¨ã break
  })  
  return targetHref
}

func findPassedIDsFrom(targetURL string) []string {
  doc, err := goquery.NewDocument(targetURL)
  if err != nil {
    log.Fatal(err)
  }
  var (
    wordList  = strings.Split(doc.Text(), "\n")
    // doc.Text()...ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå…¨ä½“ã‚’ string ã«ã—ãŸã‚‚ã®ã‚’è¿”ã™
    // ãã‚Œã‚’ \n ã§ Split ã—ã¦é…åˆ—ã«ã™ã‚‹
    passedIDs []string
    idPattern = regexp.MustCompile(`[0-2]\d{3}[A-F]`)
    // (0001ã€œ2569) + (Aã€œF) ãªã®ã§ã¨ã‚Šã‚ãˆãšã“ã‚Œã§
  )
  for _, word := range wordList {
    id := strings.TrimSpace(word)
    if idPattern.MatchString(id) {
      passedIDs = append(passedIDs, id)
    }
  }
  return passedIDs
}
```
`func main()` ãŒå…¥ã£ãŸ main.go ã¯åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ãŒã€ã“ã‚Œã¯æ™‚é–“ç®¡ç†ã—ã¦å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã§ `scrape()` ã—ã¦ã‚µãƒ¼ãƒãƒ¼ç«‹ã¦ã¦ã‚‹ã ã‘ãªã®ã§ã€ã“ã“ã§ã¯ã‚ã–ã‚ã–ç«‹ã¡å…¥ã‚‰ãªã„ã“ã¨ã«ã—ã¾ã™ã€‚ä¸€å¿œ Github ã®ãƒªãƒ³ã‚¯ã‚’ãŠã„ã¦ãŠãã®ã§ã€æ°—ã«ãªã‚‹æ–¹ã¯è¦—ã„ã¦ãã ã•ã„ã€‚
https://github.com/kana-rus/resultinformer/tree/f2b7ef4a70b27745fa10e717104874306776f5b6/src
`findHrefOf` ã¯é©å½“ãª a ã‚¿ã‚°ã®ã‚ã‚‹ã‚µã‚¤ãƒˆã‚’ä½¿ã‚ã›ã¦ã„ãŸã ã„ã¦ã€`findPassedIDsFrom` ã¯ã•ã£ãã®HTMLã‚’ãã‚Œã£ã½ãã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã—ãŸã‚‚ã®ã‚’ localhost ã—ã¦ã€ãã‚Œãã‚Œç–‘ä¼¼çš„ã«å˜ä½“ãƒ†ã‚¹ãƒˆã—ãªãŒã‚‰æ›¸ã„ã¦ãã€Bãƒšãƒ¼ã‚¸ã®HTMLãŒã‚ã‚Œã§åˆã£ã¦ã„ã‚Œã°ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã„ã‘ãã†ã ã€ã¨ã„ã†æ®µéšã¾ã§æ¥ã¾ã—ãŸã€‚

### æ–‡å­—ã‚³ãƒ¼ãƒ‰å•é¡Œ
è©¦ã—ã« `FindHrefOf` ã®å†…å®¹ã‚’ã„ã˜ã£ã¦ (ä¾‹ï¼ša ã‚¿ã‚°ã§ã¯ãªã div ã‚¿ã‚°ã‚’æ¢ã—ã€å†…å®¹ã«ã‚ˆã‚‰ãš text ã‚’å…¨ã¦å‡ºåŠ›ã•ã›ã‚‹) ã€Aãƒšãƒ¼ã‚¸ã®URLã§å®Ÿè¡Œã—ã¦ã¿ãŸã¨ã“ã‚ã€æ¼¢å­—ãƒ»ã²ã‚‰ãŒãªã®å‡ºåŠ›ãŒã€Œå·¥ã€ä»¥å¤–æ–‡å­—åŒ–ã‘ã—ã¦ã—ã¾ã„ã¾ã—ãŸã€‚`nkf` ã§æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ãŸã¨ã“ã‚ã€**ShiftJIS** ã¨ã®ã“ã¨ã€‚Aãƒšãƒ¼ã‚¸ã®HTMLã‚’è¦‹ã¦ã¿ã‚‹ã¨ meta ã‚¿ã‚°ã« charset="utf-8" ã®è¨˜è¼‰ãŒè¦‹å½“ãŸã‚‰ãªã„ã®ã§ã€é–“é•ã„ãªãã“ã®ã‚µã‚¤ãƒˆã¯æ–‡å­—ã‚³ãƒ¼ãƒ‰ãŒ ShiftJIS ã ã¨åˆ¤æ–­ã—ã¦è‰¯ã•ãã†ã§ã™ã€‚ãã“ã§ã€
https://times.hrbrain.co.jp/entry/character-code-go
https://dev.classmethod.jp/articles/golang-iconv/
ã‚ãŸã‚Šã‚’å‚è€ƒã«æ¬¡ã®é–¢æ•°ã‚’ä½œæˆã—ã¾ã—ãŸã€‚å¤‰æ›æ™‚ã®ã‚¨ãƒ©ãƒ¼ã¯è¿”ã‚Šå€¤ã«ã—ãªã„å½¢ã‚’ã¨ã£ã¦ã„ã¾ã™ã€‚
```go:scrape.go
func convertUTF8toSjis(utf8Str string) string {
  encoder := japanese.ShiftJIS.NewEncoder()
  sjisStr, _, err := transform.String(encoder, utf8Str)
  if err != nil {
    log.Fatal(err)
  }
  return sjisStr
}
```
ãŠãã‚‰ããªã„ã¨ã¯æ€ã‚ã‚Œã¾ã™ãŒã€ä¸‡ãŒä¸€ã€ŒBãƒšãƒ¼ã‚¸ã¯ utf-8 ã ã£ãŸã€ã¨ãªã£ã¦ã‚‚å¯¾å¿œã§ãã‚‹ã‚ˆã†ã«ã€æœ€åˆã«æ–‡å­—ã‚³ãƒ¼ãƒ‰ã®åˆ¤å®šã‚’ã„ã‚Œã¦å‡¦ç†ã‚’åˆ†ã‘ã‚‹å½¢ã§ `findHrefOf` ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã—ãŸã€‚

```go:scrape.go
func findHrefOf(targetWord, targetURL string) string {
  doc, err := goquery.NewDocument(targetURL)
  if err != nil {
    log.Fatal(err)
  }
  var (
    isUTF8site bool = false //default
    targetCode string
  )
  doc.Find("meta").EachWithBreak(func(i int, s *goquery.Selection) bool {
    charset, exists := s.Attr("charset")
    if exists {
      isUTF8site = (charset == "utf-8")
    }
    return !exists // charset="utf-8" ãŒã‚ã£ãŸã‚‰ break
    // ãªã‘ã‚Œã°å…¨ã¦ã® meta ã‚¿ã‚°ã‚’æ¢ã™ã“ã¨ã«ãªã‚Šã€isUTF8site = false ã®ã¾ã¾çµ‚äº†
    // ã¾ã¨ã‚‚ãª utf-8 ãƒšãƒ¼ã‚¸ã«ã¯ã“ã®è¨˜è¼‰ãŒã‚ã‚‹ã¯ãšãªã®ã§ãƒ»ãƒ»ãƒ»ã¨ã„ã†åˆ¤æ–­
    // (ã»ã‚“ã¨ã¯ã‚‚ã£ã¨ã¡ã‚ƒã‚“ã¨åˆ¤å®šã™ã¹ã)
  })
  if isUTF8site {
    targetCode = targetWord
  } else {
    targetCode = convertUTF8toSjis(targetWord)
  }

  var (
    targetHref string
    foundTarget = false
  )
  doc.Find("a").EachWithBreak(func(i int, s *goquery.Selection) bool {
    href, exists := s.Attr("href")
    isTargetTag := (s.Text() == targetCode)
    if exists && isTargetTag {
      targetHref = href
      foundTarget = true
    }
    return !isTargetTag
  })
  return targetHref
}
```
ã“ã‚Œã§æ–‡å­—åŒ–ã‘å•é¡Œã‚‚è§£æ±ºã—ã€æ€ã„ã¤ãé™ã‚Šæ„å‘³ã®ã‚ã‚Šãã†ãªç–‘ä¼¼ãƒ†ã‚¹ãƒˆãŒå…¨ã¦ãƒ‘ã‚¹ã™ã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§ã€ãŸã¶ã‚“ã“ã‚Œã§ã„ã‘ã‚‹ã ã‚ã†ã¨ã„ã†ã“ã¨ã§ Heroku ã«æŠ•å…¥ã—ã¾ã—ãŸã€‚
```go.mod:go.mod
// +heroku goVersion go1.17
go 1.17
```
ã¨ã„ã†ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã„ã‚Œãªã„ã¨å‹æ‰‹ã« Heroku ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® Go ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã—ã¾ã†ãªã©ã®å®šç•ª (ï¼Ÿ) ã®ç½ ã«å¼•ã£ã‹ã‹ã‚ŠãªãŒã‚‰ã‚‚ã€é©å®œã‚°ã‚°ã£ã¦è§£æ±ºã—ã€ç„¡äº‹ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»å®Ÿè¡Œã¾ã§è¾¿ã‚Šç€ãã¾ã—ãŸã€‚ãã®å¾Œ GAS ã®æ–¹ã‚‚å®Ÿè£…ãŒé–“ã«åˆã„ã€ã‚ã¨ã¯ç™ºè¡¨ã®ç¬é–“ã‚’å¾…ã¤ã®ã¿ã¨ãªã‚Šã¾ã—ãŸ (ç™ºè¡¨å‰æ—¥ã®æ·±å¤œ) ã€‚

ãã—ã¦è¿ãˆãŸç¿Œæœã€æ¡ˆã®å®šå¯éã”ã—ã¦ 13ï¼š00 ãã‚‰ã„ã«èµ·ãå‡ºã—ã¦ LINE ã‚’è¦‹ã‚‹ã¨ãƒ»ãƒ»ãƒ»

### æ’ƒæ²ˆ
ä½•ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚è¡¨ç¤ºã•ã‚Œã¦ãŠã‚‰ãšã€è¦‹äº‹ã«æ’ƒæ²ˆã—ã¦ã—ã¾ã„ã¾ã—ãŸ (ãƒ†ã‚¹ãƒˆã§ãã¦ã„ãªã„ã®ã§è¦šæ‚Ÿã¯ã—ã¦ã¾ã—ãŸãŒ) ã€‚
